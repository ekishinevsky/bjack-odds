<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Card Draw Odds (Hypergeometric) — Eli Kishinevsky</title>
  <meta name="description" content="From a deck with K target cards out of N, drawing n without replacement, what's the chance of ≥x (or exactly x) hits? Minimal, clear, and exact." />

  <!-- GA4 (optional) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BWPMBYVSD5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BWPMBYVSD5');
  </script>

  <style>
    :root{
      --bg:#0b0b0f; --card:#121217; --text:#f2f3f5; --muted:#a6a8ad;
      --accent:#5b8cff; --border:#22242b; --radius:14px; --good:#7aff9a;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.55 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:900px;margin:0 auto;padding:22px}
    .nav{position:sticky;top:0;background:linear-gradient(180deg,#0b0b0f,#0b0b0fd0);backdrop-filter:saturate(130%) blur(6px);border-bottom:1px solid var(--border);z-index:5}
    .nav-inner{display:flex;justify-content:space-between;align-items:center;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;color:var(--text);font-weight:800;text-decoration:none}
    .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg,var(--accent),#8ea8ff);box-shadow:0 0 14px rgba(91,140,255,.66)}
    nav a{color:var(--muted);margin-left:14px}
    nav a.active, nav a:hover{color:var(--text)}
    h1,h2,h3{margin:0 0 8px}
    .section{padding:22px 0}
    .muted{color:var(--muted)}
    .cap{font-variant:all-small-caps;letter-spacing:.5px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
    label{display:flex;flex-direction:column;gap:6px;font-size:14px}
    .input{
      border:1px solid var(--border);background:linear-gradient(180deg,#121217,#0c0c10);
      color:var(--text);border-radius:10px;padding:8px 10px;min-width:120px
    }
    .btn{border:1px solid var(--border);background:#101015;color:var(--text);border-radius:10px;padding:8px 10px;cursor:pointer}
    .radio{display:flex;gap:12px;align-items:center}
    .headline{display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-top:14px}
    .big{font-size:34px;font-weight:900;letter-spacing:.3px}
    .good{color:var(--good)}
    .sentence{font-size:15px}
    .stat{border:1px solid var(--border);border-radius:12px;padding:8px 10px;background:#101015}
    details{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:#0e0e14}
    details summary{cursor:pointer;color:var(--muted)}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
    .table th{color:var(--muted);font-weight:600}
    .num{text-align:right}
    .chip{border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:#101015;cursor:pointer}
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 12px}
    footer{border-top:1px solid var(--border);margin-top:24px}
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html"><span class="dot"></span><span>Probability Tools</span></a>
      <nav>
        <a href="index.html">All Tools</a>
        <a class="active" href="card-draw-odds.html">Card Draw</a>
        <a href="https://ekishinevsky.github.io/" target="_blank" rel="noopener">Main Site</a>
      </nav>
    </div>
  </div>

  <section class="section">
    <div class="container">
      <h2>Card Draw Odds (Hypergeometric)</h2>
      <p class="muted">Pick your deck, how many “target” cards are in it, how many you draw (no replacement), and how many hits you care about.</p>

      <!-- tiny presets for clarity -->
      <div class="chips">
        <span class="chip" data-n="52" data-k="4" data-d="5" data-x="1">52-card deck · ≥1 Ace in 5</span>
        <span class="chip" data-n="52" data-k="4" data-d="2" data-x="1">52-card deck · ≥1 Ace in 2</span>
      </div>

      <!-- Inputs -->
      <div class="card">
        <div class="row">
          <label>Deck size (N)
            <input id="N" class="input" type="number" min="1" max="100000" value="52" />
          </label>
          <label>Target cards in deck (K)
            <input id="K" class="input" type="number" min="0" max="52" value="4" />
          </label>
          <label>Draws (n) <span class="muted">(without replacement)</span>
            <input id="n" class="input" type="number" min="0" max="52" value="5" />
          </label>
          <label>Hits (x)
            <input id="x" class="input" type="number" min="0" max="5" value="1" />
          </label>
          <label>We care about
            <div class="radio">
              <label><input type="radio" name="mode" value="ge" checked> ≥ x</label>
              <label><input type="radio" name="mode" value="eq"> = x</label>
            </div>
          </label>
          <button class="btn" id="reset">Reset</button>
        </div>
        <div class="muted" style="margin-top:8px">Valid X range updates automatically. This is the exact <em>hypergeometric</em> distribution (no simulation).</div>
      </div>

      <!-- Big answer -->
      <div class="headline">
        <div>
          <div class="cap">Probability</div>
          <div id="answer" class="big good">—</div>
        </div>
        <div class="sentence" id="sentence">—</div>
      </div>

      <!-- Small facts -->
      <div class="row" style="margin-top:12px">
        <div class="stat"><span class="cap">Valid X range</span><div id="xRange"><span class="muted">—</span></div></div>
        <div class="stat"><span class="cap">E[X]</span><div id="mean"><span class="muted">—</span></div></div>
        <div class="stat"><span class="cap">SD[X]</span><div id="sd"><span class="muted">—</span></div></div>
      </div>

      <!-- Optional details -->
      <div class="section">
        <details>
          <summary>Show full distribution table (optional)</summary>
          <table class="table" id="distTable">
            <thead>
              <tr>
                <th>X (hits)</th>
                <th class="num">P(X = x)</th>
                <th class="num">P(X ≥ x)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </details>
      </div>
    </div>
  </section>

  <footer class="section">
    <div class="container">
      <div class="muted">© <span id="year"></span> Eli Kishinevsky</div>
    </div>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Elements
    const NEl = document.getElementById('N');
    const KEl = document.getElementById('K');
    const nEl = document.getElementById('n');
    const xEl = document.getElementById('x');
    const modeRadios = [...document.querySelectorAll('input[name="mode"]')];

    const answerEl = document.getElementById('answer');
    const sentenceEl = document.getElementById('sentence');
    const xRangeEl = document.getElementById('xRange');
    const meanEl = document.getElementById('mean');
    const sdEl = document.getElementById('sd');
    const tableBody = document.querySelector('#distTable tbody');

    // Presets
    document.querySelectorAll('.chip').forEach(chip=>{
      chip.addEventListener('click', ()=>{
        NEl.value = chip.dataset.n;
        KEl.value = chip.dataset.k;
        nEl.value = chip.dataset.d;
        xEl.value = chip.dataset.x;
        modeRadios.find(r=>r.value==='ge').checked = true;
        recompute();
      });
    });

    // Helpers
    const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
    const pct = (p)=> (p*100).toFixed(2) + '%';

    // Stable logGamma (Lanczos)
    function logGamma(z){
      const p = [
        0.99999999999980993, 676.5203681218851, -1259.1392167224028,
        771.32342877765313, -176.61502916214059, 12.507343278686905,
        -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7
      ];
      if(z < 0.5){
        return Math.log(Math.PI) - Math.log(Math.sin(Math.PI*z)) - logGamma(1 - z);
      } else {
        z -= 1;
        let x = p[0];
        for(let i=1; i<p.length; i++) x += p[i] / (z + i);
        const t = z + p.length - 0.5;
        return 0.5*Math.log(2*Math.PI) + (z+0.5)*Math.log(t) - t + Math.log(x) - Math.log(z+1);
      }
    }
    function logChoose(n,k){
      if(k<0 || k>n) return -Infinity;
      return logGamma(n+1) - logGamma(k+1) - logGamma(n-k+1);
    }
    function hypergeomPmf(N,K,n,x){
      if(x<0 || x>n || x>K) return 0;
      if(n>N || K>N) return 0;
      if(n - x > N - K) return 0; // can’t draw more non-targets than exist
      const logp = logChoose(K,x) + logChoose(N-K, n-x) - logChoose(N,n);
      return Math.exp(logp);
    }
    function validRange(N,K,n){
      const xmin = Math.max(0, n - (N - K));
      const xmax = Math.min(n, K);
      return { xmin, xmax };
    }
    function stats(N,K,n){
      const mean = n * (K/N);
      const variance = n * (K/N) * (1 - K/N) * ((N - n) / Math.max(1, (N - 1)));
      return { mean, sd: Math.sqrt(variance) };
    }
    function buildPmf(N,K,n){
      const { xmin, xmax } = validRange(N,K,n);
      const pmf = [];
      let total = 0;
      for(let x=xmin; x<=xmax; x++){
        const p = hypergeomPmf(N,K,n,x);
        pmf.push(p); total += p;
      }
      if(total>0){ for(let i=0;i<pmf.length;i++) pmf[i] /= total; } // normalize tiny drift
      return { pmf, xmin, xmax };
    }
    function buildTail(pmfObj){
      const { pmf } = pmfObj;
      const tail = new Array(pmf.length).fill(0);
      let acc = 0;
      for(let i=pmf.length-1;i>=0;i--){ acc += pmf[i]; tail[i] = acc; }
      return tail; // tail[i] = P(X >= xmin+i)
    }

    function renderMain(N,K,n,x,mode, pmfObj){
      const { xmin, xmax, pmf } = pmfObj;
      // clamp x to valid range
      const xc = clamp(x, xmin, xmax);
      xEl.value = xc; xEl.min = xmin; xEl.max = xmax;

      // compute main prob
      const idx = xc - xmin;
      const tail = buildTail(pmfObj);
      const pEq = (idx>=0 && idx<pmf.length) ? pmf[idx] : 0;
      const pGe = (idx>=0 && idx<pmf.length) ? tail[idx] : (xc<=xmin ? 1 : 0);
      const p = (mode==='ge') ? pGe : pEq;

      answerEl.textContent = pct(p);
      const flavor = (mode==='ge') ? `at least ${xc}` : `exactly ${xc}`;
      sentenceEl.innerHTML = `Chance of <strong>${flavor}</strong> target card(s) in <strong>${n}</strong> draw(s), from a deck of <strong>${N}</strong> with <strong>${K}</strong> targets.`;

      const { mean, sd } = stats(N,K,n);
      xRangeEl.textContent = `${xmin} to ${xmax}`;
      meanEl.textContent = mean.toFixed(2);
      sdEl.textContent = sd.toFixed(2);
    }

    function renderTable(N,K,n, mode, pmfObj){
      const { xmin, xmax, pmf } = pmfObj;
      const tail = buildTail(pmfObj);
      tableBody.innerHTML = '';
      for(let i=0;i<pmf.length;i++){
        const X = xmin + i;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${X}</td>
          <td class="num">${(pmf[i]*100).toFixed(2)}%</td>
          <td class="num">${(tail[i]*100).toFixed(2)}%</td>
        `;
        tableBody.appendChild(tr);
      }
    }

    function recompute(){
      // read inputs & sanitize
      const N = clamp(parseInt(NEl.value||52,10), 1, 100000);
      const K = clamp(parseInt(KEl.value||4,10), 0, N);
      const n = clamp(parseInt(nEl.value||5,10), 0, N);
      NEl.value = N; KEl.value = K; nEl.value = n;

      const { xmin, xmax } = validRange(N,K,n);
      const xRaw = parseInt(xEl.value||1,10);
      const x = clamp(xRaw, xmin, xmax);
      xEl.min = xmin; xEl.max = xmax; xEl.value = x;

      const mode = modeRadios.find(r=>r.checked).value;

      const pmfObj = buildPmf(N,K,n);
      renderMain(N,K,n,x,mode, pmfObj);
      renderTable(N,K,n,mode, pmfObj);
    }

    // Events
    [NEl,KEl,nEl,xEl].forEach(el => el.addEventListener('input', recompute));
    modeRadios.forEach(r => r.addEventListener('change', recompute));
    document.getElementById('reset').addEventListener('click', ()=>{
      NEl.value = 52; KEl.value = 4; nEl.value = 5; xEl.value = 1;
      modeRadios.find(r=>r.value==='ge').checked = true;
      recompute();
    });

    // Boot
    recompute();
  </script>
</body>
</html>
